# OpenAirInterface 5G NR gNB Configuration
# For SDR-O-RAN Platform Integration
# 3GPP Release 18, O-RAN Alliance Specifications
#
# Author: thc1006@ieee.org
# Date: 2025-10-27

Active_gNBs = ( "gNB-OAI-SDR");

# gNBs =
# {
#     gNB ID: 1
#     Cell Type: CELL_MACRO_GNB (macro cell)
#     Name: gNB-OAI-SDR
# };

gNBs =
(
 {
    # Identification
    gNB_ID = 1;
    gNB_name  =  "gNB-OAI-SDR";
    cell_type =  "CELL_MACRO_GNB";

    # Tracking area code, MCC/MNC
    tracking_area_code  =  1;
    plmn_list = ({
                   mcc = 001;  # Test network
                   mnc = 01;
                   mnc_length = 2;
                   snssaiList = ({
                                   sst = 1;  # Slice/Service Type (eMBB)
                                   sd  = 0x000001;
                                 });
                 });

    # Physical Cell Identity
    nr_cellid = 1;

    # PDCP/RLC/MAC/PHY configuration
    pdcp_config = ({
                     out_of_order_delivery = "no";
                     sn_size = 18;
                     discard_timer = 100;  # ms
                     t_reordering = 100;   # ms
                   });

    rlc_config = ({
                    mode = "UM";  # Unacknowledged Mode for low latency
                    sn_field_length = 12;
                    t_reassembly = 35;  # ms
                  });

    # NR specific parameters
    nr_band = 78;  # 3.5 GHz (n78)
    dl_carrierBandwidth = 106;  # PRBs (20 MHz @ 30 kHz SCS)
    ul_carrierBandwidth = 106;

    # Subcarrier spacing: 30 kHz (default for FR1)
    subcarrierSpacing = 30;  # kHz

    # Physical layer
    ssb_SubcarrierOffset = 0;
    absoluteFrequencySSB = 641280;  # GSCN for 3.5 GHz (n78)
    dl_absoluteFrequencyPointA = 640000;
    ul_absoluteFrequencyPointA = 640000;

    # SSB Configuration
    ssb_PositionsInBurst_PR = "shortBitmap";
    ssb_PositionsInBurst_Bitmap = 0x80;  # 10000000 (1 SSB)
    ssb_periodicityServingCell = 20;  # ms

    # PRACH Configuration
    prach_ConfigurationIndex = 98;  # FR1, TDD, config 98
    prach_msg1_SubcarrierSpacing = 30;  # kHz
    prach_msg1_FrequencyStart = 0;
    zeroCorrelationZoneConfig = 13;
    preambleReceivedTargetPower = -100;  # dBm
    preambleTransMax = 10;
    powerRampingStep = 4;  # dB
    ra_ResponseWindow = 20;

    # PUSCH/PDSCH Configuration
    pusch_TargetSNRx10 = 200;  # 20.0 dB
    pucch_TargetSNRx10 = 150;  # 15.0 dB

    # TDD Configuration (Band n78)
    servingCellConfigCommon_n_TimingAdvanceOffset = "n0";
    tdd-UL-DL-ConfigurationCommon = {
      referenceSubcarrierSpacing = 30;  # kHz
      dl_UL_TransmissionPeriodicity = "ms5";  # 5 ms periodicity
      nrofDownlinkSlots = 7;
      nrofDownlinkSymbols = 6;
      nrofUplinkSlots = 2;
      nrofUplinkSymbols = 4;
    };

    # PDCP/RLC parameters
    ulsch_max_frame_inactivity = 10;
    enable_sdap = "yes";
    enable_rohc = "no";  # Disable ROHC for simplicity

    # MAC scheduler
    scheduler = {
      min_grant_prb = 5;
      max_grant_prb = 106;
      min_grant_mcs = 0;
      max_grant_mcs = 28;  # 256QAM
      max_ul_harq_rounds = 4;
      max_dl_harq_rounds = 4;
    };

    # ==================================================================
    # RU (Radio Unit) Configuration
    # ==================================================================
    # Integration with SDR gRPC Server via FAPI
    # ==================================================================

    RUs = (
      {
        local_rf       = "yes";
        nb_tx          = 1;
        nb_rx          = 1;
        att_tx         = 0;
        att_rx         = 0;
        bands          = [78];
        max_pdschReferenceSignalPower = -27;  # dBm
        max_rxgain     = 110;  # dB

        # USRP Configuration (via UHD)
        sdr_addrs = "type=x310,addr=192.168.10.2,master_clock_rate=184.32e6";
        clock_src = "internal";  # or "gpsdo"
        time_src = "internal";

        # Sample rate
        samples_per_frame = 2764800;  # 30.72 MHz for 20 MHz BW

        # FAPI P5/P7 Interface to SDR gRPC Server
        # P5: Control plane (configuration, scheduling decisions)
        # P7: Data plane (IQ samples, PRACH, PUSCH/PDSCH)
        fapi_p5_addr = "sdr-grpc-server.sdr-platform.svc.cluster.local";
        fapi_p5_port = 50052;
        fapi_p7_addr = "sdr-grpc-server.sdr-platform.svc.cluster.local";
        fapi_p7_port = 50053;
      }
    );

    # ==================================================================
    # F1 Interface Configuration (DU â†” CU)
    # ==================================================================

    # F1-C: Control Plane (SCTP)
    F1_INTERFACE = {
      local_ip_address  = "0.0.0.0";  # Listen on all interfaces
      remote_ip_address = "oai-cu-cp.oran-platform.svc.cluster.local";
      local_port        = 2153;
      remote_port       = 2153;
    };

    # F1-U: User Plane (GTP-U over UDP)
    F1U_INTERFACE = {
      local_ip_address  = "0.0.0.0";
      remote_ip_address = "oai-cu-up.oran-platform.svc.cluster.local";
      local_port        = 2152;
      remote_port       = 2152;
    };

    # ==================================================================
    # L1 Configuration
    # ==================================================================

    L1s = (
      {
        num_cc = 1;  # Number of component carriers
        tr_n_preference = "local_L1";

        # Thread configuration
        thread_pool_size = 8;

        # FAPI interface
        fapi = {
          p5_vendor_specific = {
            enabled = 1;
            # Integration with VITA 49.2 bridge
            vita49_enabled = 1;
            vita49_port = 4991;
          };
        };
      }
    );

    # ==================================================================
    # MAC Configuration
    # ==================================================================

    MACRLCs = (
      {
        num_cc           = 1;
        tr_s_preference  = "local_L1";
        tr_n_preference  = "f1";

        # Scheduler configuration
        ulsch_max_frame_inactivity = 10;

        # DL/UL MCS limits
        dl_max_mcs = 28;  # 256QAM
        ul_max_mcs = 28;

        # HARQ configuration
        max_harq_rounds_dl = 4;
        max_harq_rounds_ul = 4;
      }
    );

    # ==================================================================
    # Logging Configuration
    # ==================================================================

    log_config = {
      global_log_level = "info";
      global_log_verbosity = "medium";

      # Per-component log levels
      hw_log_level = "info";
      phy_log_level = "info";
      mac_log_level = "info";
      rlc_log_level = "info";
      pdcp_log_level = "info";
      rrc_log_level = "info";
      ngap_log_level = "info";
      f1ap_log_level = "info";
    };

    # ==================================================================
    # Performance Configuration
    # ==================================================================

    # Real-time scheduling
    enable_realtime = "yes";
    thread_priority = 80;

    # CPU affinity
    cpu_affinity = "0,1,2,3";  # Pin to CPUs 0-3

    # Enable timing measurements
    enable_measurements = "yes";

 }
);

# ==================================================================
# Security Configuration (for testing)
# ==================================================================

security = {
  # Integrity algorithms
  integrity_algorithms = [ "NIA2", "NIA1", "NIA0" ];

  # Ciphering algorithms
  ciphering_algorithms = [ "NEA2", "NEA1", "NEA0" ];
};

# ==================================================================
# End of Configuration
# ==================================================================
